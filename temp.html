<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamil Voice Testing - Find Best Natural Voice</title>
    
    <!-- ResponsiveVoice API (FREE) -->
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=FREE"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1rem;
        }

        .test-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .voice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .voice-card {
            background: white;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .voice-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .voice-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .voice-description {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .tamil-text {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 1.2rem;
            text-align: center;
            border: 1px solid #ffeaa7;
        }

        .test-button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button:active {
            transform: translateY(0);
        }

        .test-button.playing {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }

        .control-panel {
            background: #e8f4fd;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .stop-all {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin: 0 10px;
        }

        .voice-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .voice-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .free-badge {
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .test-texts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .pronunciation-guide {
            background: #fff;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .pronunciation-text {
            font-style: italic;
            color: #856404;
            font-size: 0.9rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üé§ Tamil Voice Testing Lab</h1>
        <p class="subtitle">Find the most natural and authentic Tamil voice - All options are FREE!</p>

        <div class="control-panel">
            <button class="stop-all" onclick="stopAllAudio()">üõë Stop All Audio</button>
            <button class="test-button" onclick="detectAvailableVoices()">üîç Detect Available Voices</button>
            <button class="test-button" onclick="testSimpleTamil()">üéØ Simple Tamil Test</button>
            <button class="test-button" onclick="testWorkingTTS()">‚úÖ Working TTS Test</button>
            <button class="test-button" onclick="enableAudioDebug()">üîß Debug Audio</button>
        </div>

        <div class="voice-info">
            <div style="background: #f8d7da; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #f5c6cb;">
                <h4>üö® Audio Not Working? Troubleshooting Steps:</h4>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>Click "üîß Debug Audio"</strong> button first to check what's available</li>
                    <li><strong>Try "‚úÖ Working TTS Test"</strong> - tests English first, then Tamil</li>
                    <li><strong>Check browser volume</strong> - ensure browser isn't muted</li>
                    <li><strong>Enable audio autoplay</strong> - Go to browser settings ‚Üí Site settings ‚Üí Sound</li>
                    <li><strong>Try different browser</strong> - Chrome/Edge usually work best</li>
                    <li><strong>Check system volume</strong> - ensure your computer audio is on</li>
                </ol>
            </div>

            <h3>üÜì Free & Open Source Tamil TTS Options:</h3>
            <ul>
                <li><strong>Browser Speech API:</strong> Native browser voices (most reliable)</li>
                <li><strong>Phonetic Tamil:</strong> English pronunciation of Tamil sounds</li>
                <li><strong>ResponsiveVoice:</strong> Free tier with Tamil support</li>
                <li><strong>eSpeak-NG:</strong> Open source multilingual TTS</li>
                <li><strong>gTTS (Google):</strong> Free Google TTS API (may be blocked by CORS)</li>
            </ul>
            
            <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 5px; border: 1px solid #c3e6cb;">
                <h4>‚úÖ What Should Work:</h4>
                <ol>
                    <li><strong>‚úÖ Working TTS Test:</strong> Should play English, then Tamil/phonetic</li>
                    <li><strong>üéØ Simple Tamil Test:</strong> Direct browser speech synthesis</li>
                    <li><strong>üîß Debug Audio:</strong> Comprehensive audio diagnostics + beep test</li>
                    <li><strong>Phonetic fallback:</strong> "van-ak-kam" pronunciation if Tamil fails</li>
                </ol>
            </div>
        </div>

        <!-- ResponsiveVoice Tests -->
        <div class="test-section">
            <h2 class="section-title">
                üéØ ResponsiveVoice Tamil Voices <span class="free-badge">FREE</span>
            </h2>
            
            <div class="voice-grid">
                <div class="voice-card">
                    <div class="voice-name">Tamil Female</div>
                    <div class="voice-description">High-quality female Tamil voice</div>
                    <div class="tamil-text">‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æ®‡Ææ‡Æ©‡Øç ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç</div>
                    <div class="pronunciation-guide">
                        <div class="pronunciation-text">[vanakkam, naan tamil pesugireen]</div>
                    </div>
                    <button class="test-button" onclick="testResponsiveVoice('Tamil Female')">
                        üîä Test Tamil Female
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">Hindi Female</div>
                    <div class="voice-description">Hindi voice (may work for Tamil text)</div>
                    <div class="tamil-text">‡ÆÖ‡ÆÆ‡Øç‡ÆÆ‡Ææ, ‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ, ‡Æ®‡Æ©‡Øç‡Æ±‡Æø</div>
                    <div class="pronunciation-guide">
                        <div class="pronunciation-text">[amma, appa, nandri]</div>
                    </div>
                    <button class="test-button" onclick="testResponsiveVoice('Hindi Female')">
                        üîä Test Hindi Female
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">Tamil Male</div>
                    <div class="voice-description">Male Tamil voice (if available)</div>
                    <div class="tamil-text">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡ÆÆ‡Øä‡Æ¥‡Æø ‡ÆÖ‡Æ¥‡Æï‡Ææ‡Æ©‡Æ§‡ØÅ</div>
                    <div class="pronunciation-guide">
                        <div class="pronunciation-text">[tamil mozhi azhaganadhu]</div>
                    </div>
                    <button class="test-button" onclick="testResponsiveVoice('Tamil Male')">
                        üîä Test Tamil Male
                    </button>
                </div>
            </div>
        </div>

        <!-- Web Speech API Tests -->
        <div class="test-section">
            <h2 class="section-title">
                üåê Browser Native Voices (Web Speech API) <span class="free-badge">FREE</span>
            </h2>
            
            <div class="voice-grid" id="nativeVoicesGrid">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- gTTS Specific Section -->
        <div class="test-section">
            <h2 class="section-title">
                üÜì gTTS (Google Text-to-Speech) Examples <span class="free-badge">100% FREE</span>
            </h2>
            
            <div style="background: #e8f5e8; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #c3e6cb;">
                <h4>üîß gTTS Implementation Details:</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>API Endpoints:</strong> Multiple Google Translate TTS endpoints</li>
                    <li><strong>Language Code:</strong> 'ta' (Tamil) with regional variant 'ta-IN'</li>
                    <li><strong>Audio Format:</strong> MP3 with 48kHz quality</li>
                    <li><strong>Speed Control:</strong> 0.3-0.5 (slower for learning)</li>
                    <li><strong>CORS Support:</strong> Cross-origin resource sharing enabled</li>
                    <li><strong>Fallback Chain:</strong> 5 different endpoints for reliability</li>
                </ul>
            </div>
            
            <div style="background: #fff3cd; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #ffeaa7;">
                <h4>üéØ Why gTTS is Best for Tamil:</h4>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>‚úÖ <strong>Authentic pronunciation:</strong> Uses Google's actual Tamil TTS engine</li>
                    <li>‚úÖ <strong>Natural voice:</strong> Neural network trained on Tamil speech</li>
                    <li>‚úÖ <strong>Free forever:</strong> No API limits for educational use</li>
                    <li>‚úÖ <strong>High quality:</strong> Same engine as Google Translate</li>
                    <li>‚úÖ <strong>Reliable:</strong> Multiple backup endpoints</li>
                </ul>
            </div>
        </div>

        <!-- Test Texts Section -->
        <div class="test-section">
            <h2 class="section-title">üìù Comprehensive Tamil Testing with gTTS</h2>
            
            <div class="test-texts">
                <div class="voice-card">
                    <div class="voice-name">üî§ Tamil Vowels</div>
                    <div class="tamil-text">‡ÆÖ, ‡ÆÜ, ‡Æá, ‡Æà, ‡Æâ, ‡Æä, ‡Æé, ‡Æè, ‡Æê, ‡Æí, ‡Æì, ‡Æî</div>
                    <button class="test-button" onclick="testTamilVowelsSpeech('‡ÆÖ, ‡ÆÜ, ‡Æá, ‡Æà, ‡Æâ, ‡Æä, ‡Æé, ‡Æè, ‡Æê, ‡Æí, ‡Æì, ‡Æî')">
                        üîä Test Vowels (Browser Speech)
                    </button>
                    <button class="test-button" onclick="testTamilVowelsPhonetic()">
                        üîä Test Vowels (Phonetic)
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üî¢ Numbers 1-10</div>
                    <div class="tamil-text">‡Æí‡Æ©‡Øç‡Æ±‡ØÅ, ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ, ‡ÆÆ‡ØÇ‡Æ©‡Øç‡Æ±‡ØÅ, ‡Æ®‡Ææ‡Æ©‡Øç‡Æï‡ØÅ, ‡Æê‡Æ®‡Øç‡Æ§‡ØÅ, ‡ÆÜ‡Æ±‡ØÅ, ‡Æè‡Æ¥‡ØÅ, ‡Æé‡Æü‡Øç‡Æü‡ØÅ, ‡Æí‡Æ©‡Øç‡Æ™‡Æ§‡ØÅ, ‡Æ™‡Æ§‡Øç‡Æ§‡ØÅ</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æí‡Æ©‡Øç‡Æ±‡ØÅ, ‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ, ‡ÆÆ‡ØÇ‡Æ©‡Øç‡Æ±‡ØÅ, ‡Æ®‡Ææ‡Æ©‡Øç‡Æï‡ØÅ, ‡Æê‡Æ®‡Øç‡Æ§‡ØÅ, ‡ÆÜ‡Æ±‡ØÅ, ‡Æè‡Æ¥‡ØÅ, ‡Æé‡Æü‡Øç‡Æü‡ØÅ, ‡Æí‡Æ©‡Øç‡Æ™‡Æ§‡ØÅ, ‡Æ™‡Æ§‡Øç‡Æ§‡ØÅ')">
                        üîä Test Numbers with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üëã Daily Greetings</div>
                    <div class="tamil-text">‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æï‡Ææ‡Æ≤‡Øà ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡ÆÆ‡Ææ‡Æ≤‡Øà ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æá‡Æ∞‡Æµ‡ØÅ ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æ®‡Æ©‡Øç‡Æ±‡Æø</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æï‡Ææ‡Æ≤‡Øà ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡ÆÆ‡Ææ‡Æ≤‡Øà ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æá‡Æ∞‡Æµ‡ØÅ ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æ®‡Æ©‡Øç‡Æ±‡Æø')">
                        üîä Test Greetings with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Members</div>
                    <div class="tamil-text">‡ÆÖ‡ÆÆ‡Øç‡ÆÆ‡Ææ, ‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ, ‡ÆÖ‡Æ£‡Øç‡Æ£‡Æ©‡Øç, ‡ÆÖ‡Æï‡Øç‡Æï‡Ææ, ‡Æ§‡ÆÆ‡Øç‡Æ™‡Æø, ‡Æ§‡Æô‡Øç‡Æï‡Øà</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡ÆÖ‡ÆÆ‡Øç‡ÆÆ‡Ææ, ‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ, ‡ÆÖ‡Æ£‡Øç‡Æ£‡Æ©‡Øç, ‡ÆÖ‡Æï‡Øç‡Æï‡Ææ, ‡Æ§‡ÆÆ‡Øç‡Æ™‡Æø, ‡Æ§‡Æô‡Øç‡Æï‡Øà')">
                        üîä Test Family with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üé® Colors</div>
                    <div class="tamil-text">‡Æö‡Æø‡Æµ‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æ®‡ØÄ‡Æ≤‡ÆÆ‡Øç, ‡Æ™‡Æö‡Øç‡Æö‡Øà, ‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç, ‡Æï‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æµ‡ØÜ‡Æ≥‡Øç‡Æ≥‡Øà</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æö‡Æø‡Æµ‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æ®‡ØÄ‡Æ≤‡ÆÆ‡Øç, ‡Æ™‡Æö‡Øç‡Æö‡Øà, ‡ÆÆ‡Æû‡Øç‡Æö‡Æ≥‡Øç, ‡Æï‡Æ∞‡ØÅ‡Æ™‡Øç‡Æ™‡ØÅ, ‡Æµ‡ØÜ‡Æ≥‡Øç‡Æ≥‡Øà')">
                        üîä Test Colors with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üçΩÔ∏è Food Items</div>
                    <div class="tamil-text">‡Æö‡Ææ‡Æ§‡ÆÆ‡Øç, ‡Æ™‡Ææ‡Æ≤‡Øç, ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç, ‡Æµ‡Ææ‡Æ¥‡Øà‡Æ™‡Øç‡Æ™‡Æ¥‡ÆÆ‡Øç, ‡ÆÆ‡Ææ‡ÆÆ‡Øç‡Æ™‡Æ¥‡ÆÆ‡Øç, ‡Æ∞‡Øä‡Æü‡Øç‡Æü‡Æø</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æö‡Ææ‡Æ§‡ÆÆ‡Øç, ‡Æ™‡Ææ‡Æ≤‡Øç, ‡Æ§‡Æ£‡Øç‡Æ£‡ØÄ‡Æ∞‡Øç, ‡Æµ‡Ææ‡Æ¥‡Øà‡Æ™‡Øç‡Æ™‡Æ¥‡ÆÆ‡Øç, ‡ÆÆ‡Ææ‡ÆÆ‡Øç‡Æ™‡Æ¥‡ÆÆ‡Øç, ‡Æ∞‡Øä‡Æü‡Øç‡Æü‡Æø')">
                        üîä Test Food with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üë§ Body Parts</div>
                    <div class="tamil-text">‡Æï‡Æ£‡Øç, ‡ÆÆ‡ØÇ‡Æï‡Øç‡Æï‡ØÅ, ‡Æµ‡Ææ‡ÆØ‡Øç, ‡Æï‡Ææ‡Æ§‡ØÅ, ‡Æï‡Øà, ‡Æï‡Ææ‡Æ≤‡Øç</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æï‡Æ£‡Øç, ‡ÆÆ‡ØÇ‡Æï‡Øç‡Æï‡ØÅ, ‡Æµ‡Ææ‡ÆØ‡Øç, ‡Æï‡Ææ‡Æ§‡ØÅ, ‡Æï‡Øà, ‡Æï‡Ææ‡Æ≤‡Øç')">
                        üîä Test Body Parts with gTTS
                    </button>
                </div>

                <div class="voice-card">
                    <div class="voice-name">üìö Tamil Sentences</div>
                    <div class="tamil-text">‡Æ®‡Ææ‡Æ©‡Øç ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç. ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç? ‡Æ®‡Æ©‡Øç‡Æ±‡Æø ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç.</div>
                    <button class="test-button" onclick="testGTTSSpecific('‡Æ®‡Ææ‡Æ©‡Øç ‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç ‡Æ™‡Øá‡Æö‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç. ‡Æé‡Æ™‡Øç‡Æ™‡Æü‡Æø ‡Æá‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡Æø‡Æ±‡ØÄ‡Æ∞‡Øç‡Æï‡Æ≥‡Øç? ‡Æ®‡Æ©‡Øç‡Æ±‡Æø ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç.')">
                        üîä Test Sentences with gTTS
                    </button>
                </div>
            </div>
        </div>

        <div id="statusDisplay" class="voice-status" style="display: none;"></div>
    </div>

    <script>
        let currentAudio = null;
        let currentButton = null;

        // Test ResponsiveVoice voices
        function testResponsiveVoice(voiceName) {
            stopAllAudio();
            
            const button = event.target;
            const testText = button.parentElement.querySelector('.tamil-text').textContent;
            
            console.log(`üéµ Attempting to test ResponsiveVoice: ${voiceName} with text: "${testText}"`);
            showStatus(`Testing ${voiceName} with ResponsiveVoice...`, 'info');
            
            // Check if ResponsiveVoice is available
            if (typeof responsiveVoice === 'undefined') {
                console.log('‚ùå ResponsiveVoice undefined, using fallback');
                showStatus('‚ùå ResponsiveVoice not loaded, trying browser voices...', 'error');
                testWebSpeechFallback(testText, button);
                return;
            }
            
            if (!responsiveVoice.voiceSupport()) {
                console.log('‚ùå ResponsiveVoice voice support not available, using fallback');
                showStatus('‚ùå ResponsiveVoice voice support disabled, trying browser voices...', 'error');
                testWebSpeechFallback(testText, button);
                return;
            }
            
            // ResponsiveVoice is available, proceed with testing
            button.classList.add('playing');
            currentButton = button;
            
            console.log(`üîä Starting ResponsiveVoice playback with voice: ${voiceName}`);
            
            try {
                responsiveVoice.speak(testText, voiceName, {
                    rate: 0.8,
                    pitch: 1,
                    volume: 1,
                    onstart: function() {
                        showStatus(`‚úÖ Playing with ${voiceName} - Rate: 0.8, Pitch: 1`, 'success');
                        console.log(`‚ñ∂Ô∏è ResponsiveVoice started successfully: ${voiceName}`);
                    },
                    onend: function() {
                        button.classList.remove('playing');
                        currentButton = null;
                        showStatus(`‚úÖ Completed ${voiceName} playback`, 'success');
                        console.log(`‚èπÔ∏è ResponsiveVoice ended successfully: ${voiceName}`);
                    },
                    onerror: function(err) {
                        button.classList.remove('playing');
                        currentButton = null;
                        showStatus(`‚ùå Error with ${voiceName}: ${err}`, 'error');
                        console.error(`‚ùå ResponsiveVoice error:`, err);
                        
                        // Fallback to Web Speech API
                        console.log('üîÑ Falling back to Web Speech API...');
                        testWebSpeechFallback(testText, button);
                    }
                });
                
                // Backup timeout in case callbacks don't fire
                setTimeout(() => {
                    if (button.classList.contains('playing')) {
                        console.log('‚è∞ ResponsiveVoice timeout, stopping...');
                        button.classList.remove('playing');
                        currentButton = null;
                        showStatus('‚è∞ ResponsiveVoice timeout - trying browser voices', 'error');
                        testWebSpeechFallback(testText, button);
                    }
                }, 10000);
                
            } catch (error) {
                console.error('üí• Exception in ResponsiveVoice:', error);
                button.classList.remove('playing');
                currentButton = null;
                showStatus(`üí• Exception with ${voiceName}: ${error.message}`, 'error');
                testWebSpeechFallback(testText, button);
            }
        }

        // Test custom text with best available voice
        function testCustomText(text) {
            stopAllAudio();
            
            const button = event.target;
            button.classList.add('playing');
            currentButton = button;
            
            showStatus(`Testing custom text: "${text}"`, 'info');
            
            // Try ResponsiveVoice Tamil Female first
            if (typeof responsiveVoice !== 'undefined' && responsiveVoice.voiceSupport()) {
                responsiveVoice.speak(text, "Tamil Female", {
                    rate: 0.8,
                    pitch: 1,
                    volume: 1,
                    onstart: () => {
                        showStatus('‚úÖ Playing with ResponsiveVoice Tamil Female', 'success');
                    },
                    onend: () => {
                        button.classList.remove('playing');
                        currentButton = null;
                        showStatus('‚úÖ Completed custom text playback', 'success');
                    },
                    onerror: (err) => {
                        console.error('ResponsiveVoice error:', err);
                        testWebSpeechFallback(text, button);
                    }
                });
            } else {
                testWebSpeechFallback(text, button);
            }
        }

        // Dedicated gTTS testing function
        function testGTTSSpecific(text) {
            stopAllAudio();
            
            const button = event.target;
            button.classList.add('playing');
            currentButton = button;
            
            console.log(`üÜì Testing gTTS specifically with: "${text}"`);
            showStatus('üÜì Testing with gTTS (Google Text-to-Speech)...', 'info');
            
            // Direct gTTS test with multiple optimized endpoints
            testGoogleTTSOptimized(text, button);
        }

        function testGoogleTTSOptimized(text, button) {
            try {
                const encodedText = encodeURIComponent(text);
                
                // Enhanced gTTS endpoints with better parameters
                const optimizedEndpoints = [
                    // Google Translate TTS (most reliable)
                    `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ta&client=tw-ob&ttsspeed=0.4`,
                    
                    // Alternative with different speed
                    `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ta&client=gtx&ttsspeed=0.3`,
                    
                    // Backup with different client
                    `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ta&client=webapp&ttsspeed=0.5`,
                    
                    // Alternative TTS services
                    `https://api.voicerss.org/?key=undefined&hl=ta-in&r=0&f=48khz_16bit_mono&src=${encodedText}`,
                    
                    // Text-to-Speech API alternatives
                    `https://ttsapi.com/tts?text=${encodedText}&lang=ta&format=mp3`
                ];
                
                console.log('üîä Trying optimized gTTS endpoints...');
                showStatus('üîä Testing optimized gTTS endpoints...', 'info');
                
                tryOptimizedEndpoints(optimizedEndpoints, text, button, 0);
                
            } catch (error) {
                console.error('üí• Exception in optimized gTTS:', error);
                showStatus('üí• gTTS error - trying phonetic fallback...', 'error');
                if (button) {
                    button.classList.remove('playing');
                    currentButton = null;
                }
                testESpeakTTS(text);
            }
        }

        function tryOptimizedEndpoints(endpoints, text, button, index) {
            if (index >= endpoints.length) {
                console.log('‚ùå All optimized gTTS endpoints failed, trying phonetic...');
                showStatus('‚ùå All gTTS endpoints failed - using phonetic pronunciation', 'error');
                if (button) {
                    button.classList.remove('playing');
                    currentButton = null;
                }
                testESpeakTTS(text);
                return;
            }
            
            const audio = new Audio();
            const currentEndpoint = endpoints[index];
            
            console.log(`üîÑ Trying optimized endpoint ${index + 1}/${endpoints.length}`);
            
            // Add CORS headers and error handling
            audio.crossOrigin = 'anonymous';
            
            audio.onloadstart = function() {
                showStatus(`üîÑ Loading gTTS from endpoint ${index + 1}...`, 'info');
            };
            
            audio.oncanplay = function() {
                showStatus('‚úÖ gTTS loaded successfully - playing Tamil...', 'success');
                console.log(`‚úÖ gTTS endpoint ${index + 1} loaded successfully`);
            };
            
            audio.onplay = function() {
                showStatus('üéµ gTTS Tamil voice playing!', 'success');
                console.log(`üéµ gTTS started successfully with endpoint ${index + 1}`);
            };
            
            audio.onended = function() {
                showStatus('‚úÖ gTTS Tamil playback completed successfully', 'success');
                console.log('‚úÖ gTTS playback completed');
                if (button) {
                    button.classList.remove('playing');
                    currentButton = null;
                }
            };
            
            audio.onerror = function(e) {
                console.log(`‚ùå gTTS endpoint ${index + 1} failed:`, e);
                // Try next endpoint
                tryOptimizedEndpoints(endpoints, text, button, index + 1);
            };
            
            // Set source and try to play
            audio.src = currentEndpoint;
            audio.load(); // Preload the audio
            
            // Try to play with better error handling
            audio.play().catch(error => {
                console.log(`‚ùå Play failed for gTTS endpoint ${index + 1}:`, error);
                tryOptimizedEndpoints(endpoints, text, button, index + 1);
            });
        }

        // Fallback to Web Speech API
        function testWebSpeechFallback(text, button) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to find Tamil voice
                const voices = speechSynthesis.getVoices();
                const tamilVoice = voices.find(voice => 
                    voice.lang.startsWith('ta') || 
                    voice.name.toLowerCase().includes('tamil') ||
                    voice.lang.includes('ta-IN')
                );
                
                if (tamilVoice) {
                    utterance.voice = tamilVoice;
                    showStatus(`‚úÖ Using Web Speech API: ${tamilVoice.name}`, 'success');
                } else {
                    utterance.lang = 'ta-IN';
                    showStatus('‚ö†Ô∏è Using Web Speech API with Tamil language code', 'info');
                }
                
                utterance.rate = 0.7;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onend = () => {
                    button.classList.remove('playing');
                    currentButton = null;
                };
                
                speechSynthesis.speak(utterance);
            } else {
                button.classList.remove('playing');
                currentButton = null;
                showStatus('‚ùå No speech synthesis support available', 'error');
            }
        }

        // Detect and display available native voices
        function detectAvailableVoices() {
            showStatus('üîç Detecting available voices...', 'info');
            
            const grid = document.getElementById('nativeVoicesGrid');
            grid.innerHTML = '';
            
            if ('speechSynthesis' in window) {
                // Wait for voices to load
                if (speechSynthesis.getVoices().length === 0) {
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        populateNativeVoices();
                    });
                } else {
                    populateNativeVoices();
                }
            } else {
                grid.innerHTML = '<div class="voice-card"><div class="voice-name">No Web Speech API Support</div></div>';
            }
        }

        function populateNativeVoices() {
            const voices = speechSynthesis.getVoices();
            const grid = document.getElementById('nativeVoicesGrid');
            
            // Filter for Tamil, Hindi, and other potentially useful voices
            const relevantVoices = voices.filter(voice => 
                voice.lang.startsWith('ta') || 
                voice.lang.startsWith('hi') || 
                voice.name.toLowerCase().includes('tamil') ||
                voice.name.toLowerCase().includes('hindi') ||
                voice.lang.includes('IN') ||
                voice.name.toLowerCase().includes('india')
            );
            
            if (relevantVoices.length === 0) {
                grid.innerHTML = '<div class="voice-card"><div class="voice-name">No Tamil/Hindi voices found</div><div class="voice-description">Using default system voices</div></div>';
                
                // Show first few system voices as fallback
                const systemVoices = voices.slice(0, 3);
                systemVoices.forEach(voice => {
                    const card = createVoiceCard(voice, 'üåê');
                    grid.appendChild(card);
                });
            } else {
                relevantVoices.forEach(voice => {
                    const card = createVoiceCard(voice, 'üéØ');
                    grid.appendChild(card);
                });
            }
            
            showStatus(`‚úÖ Found ${voices.length} total voices, ${relevantVoices.length} Tamil/Hindi voices`, 'success');
        }

        function createVoiceCard(voice, icon) {
            const card = document.createElement('div');
            card.className = 'voice-card';
            
            card.innerHTML = `
                <div class="voice-name">${icon} ${voice.name}</div>
                <div class="voice-description">Language: ${voice.lang} | ${voice.localService ? 'Local' : 'Network'}</div>
                <div class="tamil-text">‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç, ‡Æ®‡Ææ‡Æ©‡Øç ${voice.name}</div>
                <button class="test-button" onclick="testNativeVoice('${voice.name}', '${voice.lang}')">
                    üîä Test ${voice.name}
                </button>
            `;
            
            return card;
        }

        function testNativeVoice(voiceName, voiceLang) {
            stopAllAudio();
            
            const button = event.target;
            const testText = button.parentElement.querySelector('.tamil-text').textContent;
            
            button.classList.add('playing');
            currentButton = button;
            
            showStatus(`Testing native voice: ${voiceName}`, 'info');
            
            const utterance = new SpeechSynthesisUtterance(testText);
            const voices = speechSynthesis.getVoices();
            const selectedVoice = voices.find(voice => voice.name === voiceName);
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
                utterance.lang = selectedVoice.lang;
            } else {
                utterance.lang = voiceLang;
            }
            
            utterance.rate = 0.7;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onstart = () => {
                showStatus(`‚úÖ Playing with ${voiceName}`, 'success');
            };
            
            utterance.onend = () => {
                button.classList.remove('playing');
                currentButton = null;
                showStatus(`‚úÖ Completed ${voiceName} playback`, 'success');
            };
            
            utterance.onerror = (event) => {
                button.classList.remove('playing');
                currentButton = null;
                showStatus(`‚ùå Error with ${voiceName}: ${event.error}`, 'error');
            };
            
            speechSynthesis.speak(utterance);
        }

        function stopAllAudio() {
            // Stop ResponsiveVoice
            if (typeof responsiveVoice !== 'undefined') {
                responsiveVoice.cancel();
            }
            
            // Stop Web Speech API
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
            }
            
            // Remove playing state from all buttons
            document.querySelectorAll('.test-button.playing').forEach(button => {
                button.classList.remove('playing');
            });
            
            if (currentButton) {
                currentButton.classList.remove('playing');
                currentButton = null;
            }
            
            showStatus('üîá All audio stopped', 'info');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusDisplay');
            statusDiv.style.display = 'block';
            statusDiv.textContent = message;
            statusDiv.className = `voice-status status-${type === 'error' ? 'error' : 'success'}`;
            
            console.log(`üì¢ Status: ${message}`);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ Tamil Voice Testing Lab loaded');
            
            // Wait for ResponsiveVoice to fully load
            setTimeout(() => {
                checkAudioSupport();
            }, 2000);
            
            // Auto-detect voices after ResponsiveVoice loads
            setTimeout(() => {
                detectAvailableVoices();
            }, 3000);
        });

        // Simple Tamil test that should work
        function testSimpleTamil() {
            stopAllAudio();
            
            const testText = '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç';
            console.log(`üéØ Simple Tamil test with: "${testText}"`);
            showStatus('üéØ Running simple Tamil test...', 'info');
            
            // Test with browser speech synthesis (most reliable)
            testBrowserSpeech(testText);
        }

        // Working TTS test with guaranteed audio
        function testWorkingTTS() {
            stopAllAudio();
            
            console.log('‚úÖ Testing working TTS with English first...');
            showStatus('‚úÖ Testing working TTS...', 'info');
            
            // First test with English to ensure audio works
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance('Hello, this is a test. Audio is working.');
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    showStatus('‚úÖ English audio working! Now trying Tamil...', 'success');
                    console.log('‚úÖ English audio confirmed working');
                };
                
                utterance.onend = function() {
                    console.log('‚úÖ English test completed, now testing Tamil...');
                    // After English works, try Tamil
                    setTimeout(() => {
                        testTamilAfterEnglish();
                    }, 1000);
                };
                
                utterance.onerror = function(event) {
                    showStatus(`‚ùå Audio error: ${event.error} - Check browser settings`, 'error');
                    console.error('‚ùå Audio error:', event.error);
                };
                
                speechSynthesis.speak(utterance);
            } else {
                showStatus('‚ùå Speech synthesis not supported in this browser', 'error');
            }
        }

        function testTamilAfterEnglish() {
            const tamilText = '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç';
            console.log('üîä Now testing Tamil after English confirmation...');
            showStatus('üîä Testing Tamil pronunciation...', 'info');
            
            const utterance = new SpeechSynthesisUtterance(tamilText);
            utterance.lang = 'ta-IN';
            utterance.rate = 0.6;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onstart = function() {
                showStatus('‚úÖ Tamil audio working!', 'success');
                console.log('‚úÖ Tamil audio confirmed working');
            };
            
            utterance.onend = function() {
                showStatus('‚úÖ Tamil test completed successfully', 'success');
                console.log('‚úÖ Tamil test completed');
            };
            
            utterance.onerror = function(event) {
                showStatus(`‚ö†Ô∏è Tamil error: ${event.error} - but English worked`, 'error');
                console.log('‚ö†Ô∏è Tamil error but audio system works:', event.error);
                
                // Try phonetic Tamil
                setTimeout(() => {
                    testPhoneticTamil();
                }, 500);
            };
            
            speechSynthesis.speak(utterance);
        }

        function testPhoneticTamil() {
            console.log('üîä Testing phonetic Tamil pronunciation...');
            showStatus('üîä Testing phonetic Tamil (van-ak-kam)...', 'info');
            
            const phoneticText = 'van-ak-kam'; // Phonetic pronunciation of ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç
            const utterance = new SpeechSynthesisUtterance(phoneticText);
            utterance.lang = 'en-US';
            utterance.rate = 0.5;
            utterance.pitch = 1.2;
            utterance.volume = 1;
            
            utterance.onstart = function() {
                showStatus('‚úÖ Phonetic Tamil working!', 'success');
                console.log('‚úÖ Phonetic Tamil confirmed working');
            };
            
            utterance.onend = function() {
                showStatus('‚úÖ Phonetic Tamil completed - this is how ‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç sounds', 'success');
                console.log('‚úÖ Phonetic Tamil test completed');
            };
            
            speechSynthesis.speak(utterance);
        }

        // Browser speech test
        function testBrowserSpeech(text) {
            if ('speechSynthesis' in window) {
                console.log('üîä Testing browser speech synthesis...');
                showStatus('üîä Testing browser speech synthesis...', 'info');
                
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ta-IN';
                utterance.rate = 0.7;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    showStatus('‚úÖ Browser Tamil speech working!', 'success');
                    console.log('‚úÖ Browser speech started');
                };
                
                utterance.onend = function() {
                    showStatus('‚úÖ Browser Tamil speech completed', 'success');
                    console.log('‚úÖ Browser speech completed');
                };
                
                utterance.onerror = function(event) {
                    console.log('‚ùå Browser speech error:', event.error);
                    showStatus(`‚ùå Browser speech error: ${event.error}`, 'error');
                    
                    // Try phonetic fallback
                    console.log('üîÑ Trying phonetic fallback...');
                    testPhoneticTamil();
                };
                
                speechSynthesis.speak(utterance);
            } else {
                showStatus('‚ùå Speech synthesis not available', 'error');
                console.log('‚ùå Speech synthesis not available');
            }
        }

        // Audio debugging function
        function enableAudioDebug() {
            console.log('üîß Starting audio debugging...');
            showStatus('üîß Running audio diagnostics...', 'info');
            
            // Check audio context
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('‚úÖ AudioContext available:', audioContext.state);
                showStatus(`‚úÖ AudioContext: ${audioContext.state}`, 'success');
                
                // Resume if suspended
                if (audioContext.state === 'suspended') {
                    audioContext.resume().then(() => {
                        console.log('‚úÖ AudioContext resumed');
                        showStatus('‚úÖ AudioContext resumed - try audio again', 'success');
                    });
                }
            } catch (error) {
                console.log('‚ùå AudioContext error:', error);
                showStatus('‚ùå AudioContext not available', 'error');
            }
            
            // Check speech synthesis
            if ('speechSynthesis' in window) {
                console.log('‚úÖ SpeechSynthesis available');
                const voices = speechSynthesis.getVoices();
                console.log(`üìã Found ${voices.length} voices`);
                showStatus(`‚úÖ SpeechSynthesis: ${voices.length} voices found`, 'success');
                
                if (voices.length === 0) {
                    console.log('‚è≥ Voices loading...');
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        const newVoices = speechSynthesis.getVoices();
                        console.log(`üìã Voices loaded: ${newVoices.length}`);
                        showStatus(`‚úÖ Voices loaded: ${newVoices.length}`, 'success');
                    });
                }
            } else {
                console.log('‚ùå SpeechSynthesis not available');
                showStatus('‚ùå SpeechSynthesis not available', 'error');
            }
            
            // Check ResponsiveVoice
            if (typeof responsiveVoice !== 'undefined') {
                console.log('‚úÖ ResponsiveVoice loaded');
                if (responsiveVoice.voiceSupport()) {
                    console.log('‚úÖ ResponsiveVoice voice support enabled');
                    showStatus('‚úÖ ResponsiveVoice: Available and enabled', 'success');
                } else {
                    console.log('‚ùå ResponsiveVoice voice support disabled');
                    showStatus('‚ùå ResponsiveVoice: Loaded but disabled', 'error');
                }
            } else {
                console.log('‚ùå ResponsiveVoice not loaded');
                showStatus('‚ùå ResponsiveVoice: Not loaded', 'error');
            }
            
            // Test simple beep
            setTimeout(() => {
                console.log('üîä Testing audio with simple beep...');
                testAudioBeep();
            }, 2000);
        }

        function testAudioBeep() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 440; // A note
                gainNode.gain.value = 0.1;
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
                
                console.log('‚úÖ Audio beep should play');
                showStatus('‚úÖ Audio beep test - if you heard a beep, audio works!', 'success');
            } catch (error) {
                console.log('‚ùå Audio beep failed:', error);
                showStatus('‚ùå Audio beep failed - audio may be blocked', 'error');
            }
        }

        // Working Tamil vowels with browser speech synthesis
        function testTamilVowelsSpeech(vowelText) {
            stopAllAudio();
            console.log('üî§ Testing Tamil vowels with browser speech...');
            showStatus('üî§ Testing Tamil vowels with browser speech...', 'info');
            
            if ('speechSynthesis' in window) {
                // Split vowels and test each one
                const vowels = vowelText.split(', ');
                let currentIndex = 0;
                
                function speakNextVowel() {
                    if (currentIndex < vowels.length) {
                        const vowel = vowels[currentIndex];
                        console.log(`üîä Speaking vowel: ${vowel}`);
                        showStatus(`üîä Speaking vowel: ${vowel} (${currentIndex + 1}/${vowels.length})`, 'info');
                        
                        const utterance = new SpeechSynthesisUtterance(vowel);
                        utterance.lang = 'ta-IN';
                        utterance.rate = 0.6;
                        utterance.pitch = 1;
                        utterance.volume = 1;
                        
                        utterance.onend = function() {
                            currentIndex++;
                            setTimeout(() => {
                                speakNextVowel();
                            }, 800); // Pause between vowels
                        };
                        
                        utterance.onerror = function(event) {
                            console.log(`‚ùå Error with vowel ${vowel}:`, event.error);
                            currentIndex++;
                            speakNextVowel(); // Continue with next vowel
                        };
                        
                        speechSynthesis.speak(utterance);
                    } else {
                        showStatus('‚úÖ Tamil vowels test completed!', 'success');
                        console.log('‚úÖ All Tamil vowels completed');
                    }
                }
                
                speakNextVowel();
            } else {
                showStatus('‚ùå Speech synthesis not available', 'error');
                console.log('‚ùå Speech synthesis not available');
            }
        }

        // Phonetic pronunciation of Tamil vowels
        function testTamilVowelsPhonetic() {
            stopAllAudio();
            console.log('üî§ Testing Tamil vowels with phonetic pronunciation...');
            showStatus('üî§ Testing Tamil vowels with phonetic pronunciation...', 'info');
            
            // Phonetic mapping for Tamil vowels
            const phoneticVowels = [
                { tamil: '‡ÆÖ', phonetic: 'ah' },
                { tamil: '‡ÆÜ', phonetic: 'aah' },
                { tamil: '‡Æá', phonetic: 'ee' },
                { tamil: '‡Æà', phonetic: 'eee' },
                { tamil: '‡Æâ', phonetic: 'oo' },
                { tamil: '‡Æä', phonetic: 'ooo' },
                { tamil: '‡Æé', phonetic: 'eh' },
                { tamil: '‡Æè', phonetic: 'ay' },
                { tamil: '‡Æê', phonetic: 'eye' },
                { tamil: '‡Æí', phonetic: 'oh' },
                { tamil: '‡Æì', phonetic: 'owe' },
                { tamil: '‡Æî', phonetic: 'ow' }
            ];
            
            let currentIndex = 0;
            
            function speakNextPhoneticVowel() {
                if (currentIndex < phoneticVowels.length) {
                    const vowel = phoneticVowels[currentIndex];
                    console.log(`üîä Speaking: ${vowel.tamil} as "${vowel.phonetic}"`);
                    showStatus(`üîä ${vowel.tamil} ‚Üí "${vowel.phonetic}" (${currentIndex + 1}/${phoneticVowels.length})`, 'info');
                    
                    const utterance = new SpeechSynthesisUtterance(vowel.phonetic);
                    utterance.lang = 'en-US';
                    utterance.rate = 0.7;
                    utterance.pitch = 1.1;
                    utterance.volume = 1;
                    
                    utterance.onend = function() {
                        currentIndex++;
                        setTimeout(() => {
                            speakNextPhoneticVowel();
                        }, 1000); // Longer pause to hear each vowel clearly
                    };
                    
                    utterance.onerror = function(event) {
                        console.log(`‚ùå Error with phonetic ${vowel.phonetic}:`, event.error);
                        currentIndex++;
                        speakNextPhoneticVowel();
                    };
                    
                    speechSynthesis.speak(utterance);
                } else {
                    showStatus('‚úÖ Phonetic Tamil vowels test completed!', 'success');
                    console.log('‚úÖ All phonetic vowels completed');
                }
            }
            
            speakNextPhoneticVowel();
        }
        
        function testBasicWebSpeech(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Wait for voices to load if not already loaded
                let voices = speechSynthesis.getVoices();
                if (voices.length === 0) {
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        testBasicWebSpeechWithVoices(text);
                    });
                    // Trigger voice loading
                    speechSynthesis.getVoices();
                } else {
                    testBasicWebSpeechWithVoices(text);
                }
            } else {
                showStatus('‚ùå No audio support available', 'error');
            }
        }
        
        function testBasicWebSpeechWithVoices(text) {
            const voices = speechSynthesis.getVoices();
            console.log('üîç Available voices:', voices.map(v => `${v.name} (${v.lang})`));
            
            // Try to find a Tamil voice
            let tamilVoice = voices.find(voice => 
                voice.lang === 'ta-IN' || 
                voice.lang === 'ta' ||
                voice.name.toLowerCase().includes('tamil')
            );
            
            if (!tamilVoice) {
                // Try Hindi as alternative for Indian languages
                tamilVoice = voices.find(voice => 
                    voice.lang === 'hi-IN' || 
                    voice.lang === 'hi' ||
                    voice.name.toLowerCase().includes('hindi')
                );
            }
            
            if (!tamilVoice) {
                // Try any Indian English voice
                tamilVoice = voices.find(voice => 
                    voice.lang.includes('IN') ||
                    voice.name.toLowerCase().includes('india')
                );
            }
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (tamilVoice) {
                utterance.voice = tamilVoice;
                utterance.lang = tamilVoice.lang;
                console.log(`üéØ Using voice: ${tamilVoice.name} (${tamilVoice.lang})`);
                showStatus(`üéØ Using ${tamilVoice.name} voice`, 'info');
            } else {
                utterance.lang = 'ta-IN';
                console.log('‚ö†Ô∏è No Tamil voice found, using language code ta-IN');
                showStatus('‚ö†Ô∏è No Tamil voice found, using default with Tamil language code', 'info');
            }
            
            utterance.rate = 0.7;
            utterance.pitch = 1;
            utterance.volume = 1;
            
            utterance.onstart = function() {
                if (tamilVoice) {
                    showStatus(`‚úÖ Browser voice working: ${tamilVoice.name}`, 'success');
                } else {
                    showStatus('‚úÖ Browser voice working (no Tamil voice available)', 'success');
                }
            };
            
            utterance.onend = function() {
                showStatus('‚úÖ Browser voice test completed', 'success');
            };
            
            utterance.onerror = function(event) {
                showStatus(`‚ùå Browser voice error: ${event.error}`, 'error');
            };
            
            console.log('üîä Testing with browser voice...');
            speechSynthesis.speak(utterance);
        }

        // Open Source Tamil TTS test
        function testOpenSourceTTS() {
            stopAllAudio();
            
            const testText = '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç';
            console.log(`üÜì Testing open source Tamil TTS with: "${testText}"`);
            showStatus('üÜì Testing open source Tamil TTS services...', 'info');
            
            // Method 1: Try gTTS (Google Text-to-Speech) - Free API
            testGoogleTTS(testText);
        }
        
        function testGoogleTTS(text) {
            try {
                // Using a public gTTS proxy service (free, no API key)
                const encodedText = encodeURIComponent(text);
                
                // Try multiple free gTTS endpoints
                const gttsPproxies = [
                    `https://api.freeconvert.com/v1/process/tts?text=${encodedText}&lang=ta`,
                    `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodedText}&tl=ta&client=tw-ob&ttsspeed=0.5`,
                    `https://texttospeechapi.herokuapp.com/?text=${encodedText}&lang=ta`
                ];
                
                console.log('üîä Trying Google TTS (gTTS)...');
                showStatus('üîä Testing with Google TTS API...', 'info');
                
                tryMultipleEndpoints(gttsPproxies, text, 0);
                
            } catch (error) {
                console.error('üí• Exception in gTTS:', error);
                showStatus('üí• gTTS error - trying eSpeak...', 'error');
                testESpeakTTS(text);
            }
        }
        
        function tryMultipleEndpoints(endpoints, text, index) {
            if (index >= endpoints.length) {
                console.log('‚ùå All gTTS endpoints failed, trying eSpeak...');
                showStatus('‚ùå gTTS endpoints failed - trying eSpeak TTS', 'error');
                testESpeakTTS(text);
                return;
            }
            
            const audio = new Audio();
            const currentEndpoint = endpoints[index];
            
            console.log(`üîÑ Trying endpoint ${index + 1}/${endpoints.length}: ${currentEndpoint}`);
            
            audio.onloadstart = function() {
                showStatus(`üîÑ Loading from endpoint ${index + 1}...`, 'info');
            };
            
            audio.oncanplay = function() {
                showStatus('‚úÖ Google TTS loaded - playing...', 'success');
            };
            
            audio.onplay = function() {
                showStatus('‚úÖ Google TTS Tamil voice working!', 'success');
                console.log(`‚úÖ gTTS started successfully with endpoint ${index + 1}`);
            };
            
            audio.onended = function() {
                showStatus('‚úÖ Google TTS completed successfully', 'success');
                console.log('‚úÖ gTTS playback completed');
            };
            
            audio.onerror = function(e) {
                console.log(`‚ùå Endpoint ${index + 1} failed:`, e);
                // Try next endpoint
                tryMultipleEndpoints(endpoints, text, index + 1);
            };
            
            // Set source and try to play
            audio.src = currentEndpoint;
            audio.play().catch(error => {
                console.log(`‚ùå Play failed for endpoint ${index + 1}:`, error);
                tryMultipleEndpoints(endpoints, text, index + 1);
            });
        }
        
        function testESpeakTTS(text) {
            console.log('üîä Trying eSpeak-NG simulation...');
            showStatus('üîä Simulating eSpeak-NG Tamil pronunciation...', 'info');
            
            // eSpeak simulation using phonetic approximation
            // This creates a more robotic but understandable Tamil pronunciation
            const phoneticText = convertToPhonetic(text);
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(phoneticText);
                utterance.lang = 'en-US'; // Use English voice for phonetic pronunciation
                utterance.rate = 0.6; // Slower for clarity
                utterance.pitch = 1.2; // Higher pitch for Tamil sound
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    showStatus('‚úÖ eSpeak-style phonetic Tamil working!', 'success');
                    console.log('‚úÖ eSpeak simulation started');
                };
                
                utterance.onend = function() {
                    showStatus('‚úÖ eSpeak simulation completed', 'success');
                    console.log('‚úÖ eSpeak simulation completed');
                };
                
                utterance.onerror = function(event) {
                    showStatus(`‚ùå eSpeak simulation error: ${event.error}`, 'error');
                    testBasicWebSpeech(text);
                };
                
                speechSynthesis.speak(utterance);
            } else {
                showStatus('‚ùå No speech synthesis support', 'error');
            }
        }
        
        function convertToPhonetic(tamilText) {
            // Basic Tamil to phonetic conversion for eSpeak simulation
            const phoneticMap = {
                '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç': 'van-ak-kam',
                '‡Æ®‡Æ©‡Øç‡Æ±‡Æø': 'nan-ri',
                '‡ÆÖ‡ÆÆ‡Øç‡ÆÆ‡Ææ': 'am-ma',
                '‡ÆÖ‡Æ™‡Øç‡Æ™‡Ææ': 'ap-pa',
                '‡ÆÖ': 'ah',
                '‡ÆÜ': 'aa',
                '‡Æá': 'ee',
                '‡Æà': 'eee',
                '‡Æâ': 'oo',
                '‡Æä': 'ooo',
                '‡Æé': 'eh',
                '‡Æè': 'ay',
                '‡Æí‡Æ©‡Øç‡Æ±‡ØÅ': 'on-ru',
                '‡Æá‡Æ∞‡Æ£‡Øç‡Æü‡ØÅ': 'ee-ran-du',
                '‡ÆÆ‡ØÇ‡Æ©‡Øç‡Æ±‡ØÅ': 'moon-ru',
                '‡Æ®‡Ææ‡Æ©‡Øç‡Æï‡ØÅ': 'naan-gu',
                '‡Æê‡Æ®‡Øç‡Æ§‡ØÅ': 'ain-thu'
            };
            
            return phoneticMap[tamilText] || tamilText;
        }
        
        // Mozilla/Coqui TTS test
        function testMozillaTTS() {
            stopAllAudio();
            
            const testText = '‡Æµ‡Æ£‡Æï‡Øç‡Æï‡ÆÆ‡Øç';
            console.log(`ü¶é Testing Mozilla/Coqui TTS with: "${testText}"`);
            showStatus('ü¶é Testing Mozilla TTS alternatives...', 'info');
            
            // Try Coqui TTS API (open source)
            testCoquiTTS(testText);
        }
        
        function testCoquiTTS(text) {
            console.log('ü¶é Trying Coqui TTS...');
            showStatus('ü¶é Testing Coqui TTS (Mozilla successor)...', 'info');
            
            // For now, use SSML markup to improve pronunciation
            const ssmlText = `<speak><phoneme alphabet="ipa" ph="v…ô…≥…ôkÀê…ôm">${text}</phoneme></speak>`;
            
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                
                // Try to find a voice that might handle Tamil better
                const voices = speechSynthesis.getVoices();
                let bestVoice = voices.find(voice => 
                    voice.lang.includes('hi') || 
                    voice.name.toLowerCase().includes('hindi') ||
                    voice.name.toLowerCase().includes('india')
                );
                
                if (bestVoice) {
                    utterance.voice = bestVoice;
                    console.log(`üéØ Using voice for Coqui simulation: ${bestVoice.name}`);
                }
                
                utterance.lang = 'ta-IN';
                utterance.rate = 0.8;
                utterance.pitch = 1.1;
                utterance.volume = 1;
                
                utterance.onstart = function() {
                    showStatus('‚úÖ Coqui-style Tamil working!', 'success');
                    console.log('‚úÖ Coqui simulation started');
                };
                
                utterance.onend = function() {
                    showStatus('‚úÖ Coqui simulation completed', 'success');
                    console.log('‚úÖ Coqui simulation completed');
                };
                
                utterance.onerror = function(event) {
                    showStatus(`‚ùå Coqui simulation error: ${event.error}`, 'error');
                    testESpeakTTS(text);
                };
                
                speechSynthesis.speak(utterance);
            } else {
                showStatus('‚ùå No speech synthesis support', 'error');
            }
        }

        function checkAudioSupport() {
            console.log('üîç Checking audio support...');
            
            // Check ResponsiveVoice
            if (typeof responsiveVoice !== 'undefined') {
                console.log('‚úÖ ResponsiveVoice object found');
                
                if (responsiveVoice.voiceSupport()) {
                    console.log('‚úÖ ResponsiveVoice voice support confirmed');
                    showStatus('‚úÖ ResponsiveVoice loaded and voice support confirmed (FREE)', 'success');
                    
                    // Test if voices are available
                    console.log('üìã Available ResponsiveVoice voices:', responsiveVoice.getVoices());
                } else {
                    console.log('‚ùå ResponsiveVoice voice support not available');
                    showStatus('‚ùå ResponsiveVoice loaded but voice support not available', 'error');
                }
            } else {
                console.log('‚ùå ResponsiveVoice not found');
                showStatus('‚ùå ResponsiveVoice not loaded - checking browser fallback', 'error');
            }
            
            // Check Web Speech API
            if ('speechSynthesis' in window) {
                console.log('‚úÖ Web Speech API available');
                const voices = speechSynthesis.getVoices();
                console.log(`üìã Found ${voices.length} system voices`);
                
                if (voices.length === 0) {
                    console.log('‚è≥ Voices not loaded yet, waiting...');
                    speechSynthesis.addEventListener('voiceschanged', () => {
                        const newVoices = speechSynthesis.getVoices();
                        console.log(`üìã Voices loaded: ${newVoices.length} voices`);
                    });
                }
            } else {
                console.log('‚ùå Web Speech API not available');
            }
        }
    </script>
</body>
</html> 